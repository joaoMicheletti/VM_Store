<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./indexStyle.css"/>
    <link rel="stylesheet" href="./loginRegister.css"/>
    <link rel="stylesheet" href="./carrinho.css"/>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <title>Vita Micheletti | Carrinho</title>
    <script >
        const Api = axios;
        const url = 'http://127.0.0.1:3000/image/';  
        const Adicionados = [];
        const Aprovados = [];      
        //array para traze os produtos em si.
        const AllProdutos = [];
        var ImgId = [];
        
        window.onload = async function(){
            if(localStorage.getItem('token') === null){
                alert('Você não tem privilegios para acessar essa página.');
                window.location.href = 'index.html';
            } else {
                //buscar os podutos no carrinho do usuario.
                const Data = {token: localStorage.getItem('token')};
                await Api.post('http://127.0.0.1:3000/getcarrinho', Data).then((Response) =>{
                    if(Response.data.list.length === 0){
                        document.querySelector("#addicionados").textContent = "Nenhum produto adicionado!"
                        var add = document.querySelector("#pedidosPendentes");
                        add.style.display = 'none';
                        var apro = document.querySelector("#aprovados");
                        apro.style.display = 'none';
                    } else {
                        //separar os produtos aprovados/adicionadas status : carrinho = adicionado | status: aprovado = aprovado;
                        var c = 0;
                        while(c < Response.data.list.length){
                            if(Response.data.list[c].status === 'carrinho'){
                                Adicionados.push(Response.data.list[c]);
                                AllProdutos.push(Response.data.list[c].id_produto);
                            } else if(Response.data.list[c].status === 'aprovado'){
                                Aprovados.push(Response.data.list[c]);
                            };
                            c+=1;
                        };
                        async function InfoProdutos() {
                            //buscar as informações dos produtos adicionados no carrinho.
                            //objeto aceitavel para a request:
                            var Data = [];
                            var cont = 0;
                            while (cont < AllProdutos.length){
                                Data.push(AllProdutos[cont]);
                                cont+=1;
                            };
                            
                            await Api.post('http://127.0.0.1:3000/infoproduto', Data)
                            .then((Response) => {
                                const listaProdutos = Response.data.listaProdutos;

                                for (const produto of listaProdutos) {
                                    if (produto) {
                                        const { id, img } = produto;
                                        // Adicionar o id e img no objeto ImgId
                                        ImgId.push(produto);
                                    };
                                };
                            })
                            .catch((Erro) => {
                                console.log(Erro);
                            });

                        };
                        InfoProdutos();                        
                    };
                }).catch((Erro) =>{
                    console.log(Erro);
                });
            };
        };
        console.log(ImgId);
    </script>
</head>
<body>
    <header>
        <div id="ContentHeader"> 
            
            <div id="LogoAndName">
                <img  id="ImgLogo" src="assets/headerLogo.png" alt="logo Header"/>
                <h1 id="H1Name">Vita Micheletti</h1>
            </div>
            <div id="navigation">
                <a href="login.html"><img id="Profile" src="assets/perfil.png" alt="profile"/></a>
                <a href="carrinho.html"><img id="Cart" src="assets/sacola.png" alt="cart"/></a>
            </div>
        </div>
        <hr/>
        <div id="SubHeader">
            <div id="ContentSubHeader">
                <li><a href="index.html">Offerte</a></li>
                <li><a href="index.html">Masculino</a></li>
                <li><a href="index.html">Feminino</a></li>
            </div>
        </div>
    </header>
    <section id="pendentes">
        <h3 id="addicionados">Pedidos adicionados</h3>
        <br/>
        <br/>
        <br/>
        <br/>
        <div id="pedidosPendentes">
            <div id="RoupasF">
                <button class="btnPN" onclick="prevSlide('RoupasF', 'roupas-slide')">&lt;</button>
                
                <div id="roupas-slide">
                    <img class="imgSlides" src="assets/0001.webp"/>
                    
                </div>
                <div id="roupas-slide">
                    <img class="imgSlides" src="assets/0001.webp"/>
                    
                </div>
                <div id="roupas-slide">
                    <img class="imgSlides" src="assets/0001.webp"/>
                    
                </div>
                <button class="btnPN" onclick="nextSlide('RoupasF', 'roupas-slide')">&gt;</button>
            </div>
            <br/>
            
        </div>
    </section>   
    <section id="aprovados">
        <h3>PedidosFinalizados</h3>
        <div id="pedidosFinalizados">
            
            <br/>
            <br/>
            <br/>
            <br/>
            </div>
            <div id="RoupasF">
                <button class="btnPN" onclick="prevSlide('RoupasF', 'roupas-slide')">&lt;</button>
                
                <div id="roupas-slide">
                    <img class="imgSlides" src="assets/0001.webp"/>
                    
                </div>
                <div id="roupas-slide">
                    <img class="imgSlides" src="assets/0001.webp"/>
                    
                </div>
                <div id="roupas-slide">
                    <img class="imgSlides" src="assets/0001.webp"/>
                    
                </div>
                <button class="btnPN" onclick="nextSlide('RoupasF', 'roupas-slide')">&gt;</button>
            </div>
            <br/>
    </section>
    <footer>
        <div class="footer-container">
            <div class="footer-section">
                <p>&copy; 2024 Nome do Salão. Todos os direitos reservados.</p>
            </div>
            <div class="footer-section">
                <p>Horário de Funcionamento: 24H</p>
            </div>
            <div class="footer-section">
                <p>Desenvolvido por: <a href="https://nimble-conkies-fa2423curso-de-nodejs.netlify.app/vm/" target="_blank">VM_Software</a></p>
                <div class="social-links">
                    <a href="https://www.instagram.com/vm_software/" target="_blank">Facebook</a> | 
                    <a href="https://www.instagram.com/vm_software/" target="_blank">Instagram</a> | 
                    <a href="https://nimble-conkies-fa2423curso-de-nodejs.netlify.app/vm/" target="_blank">Site</a>
                </div>
            </div>
        </div>
    </footer>  
</body>
</html>